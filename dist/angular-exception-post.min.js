/**
 * Angular client exception POSTer
 * @version v0.1 - 2014-05-12
 * @link https://github.com/loosebits/angular-exception-post
 * @author Rand McNeely <loosebits@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,b){"use strict";function c(){if(typeof XMLHttpRequest!==b)return new XMLHttpRequest;if(window.ActiveXObject)for(var a,c=["MSXML2.XMLHttp.5.0","MSXML2.XMLHttp.4.0","MSXML2.XMLHttp.3.0","MSXML2.XMLHttp","Microsoft.XMLHttp"],d=0;d<c.length;d++)try{return a=new ActiveXObject(c[d])}catch(e){}}function d(a){var b=c(a.success,a.error);b.open("post",a.url,!0),b.setRequestHeader("Content-Type","application/json"),b.send(a.data),b.onreadystatechange=function(){4===b.readyState&&(200===b.status?a.success.call(null,b.responseText):a.error.call(null,b.responseText))}}a.module("loosebits.client.exception.post",[]).factory("stacktraceService",function(){return{print:printStackTrace}}).provider("$exceptionHandler",function(){this.$get=["errorLogService",function(a){return a}]}).provider("errorLogService",function(){var c,e,f="client-errors",g=200,h=!0;this.postUrl=function(a){return f=a,this},this.onSuccess=function(a){return c=a,this},this.debounce=function(a){return g=a,this},this.$get=["$log","$window","stacktraceService","$injector",function(i,j,k,l){function m(m,n){i.error.apply(i,arguments);try{var o=m.toString(),p=k.print({e:m});e&&(j.clearTimeout(e),e=b),h&&d({url:f,data:a.toJson({errorUrl:j.location.href,errorMessage:o,stackTrace:p,userAgent:navigator.userAgent,cause:n||""}),success:function(){if(c)try{var a=l.get(c);a.apply(a,arguments)}catch(b){i.error("Error calling callback",b)}},error:function(a){i.warn("Error logging failed"),i.log(a)}}),g&&(h=!1,e||(e=j.setTimeout(function(){h=!0},g)))}catch(q){i.warn("Error logging failed"),i.log(q)}}return m}]})}(angular);